<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Wingstall</title>
    <link href="style/style.css" rel="stylesheet" type="text/css" />
</head>
<body>
    <h1>Wingstall</h1>

    <h2>Table of contents</h2>

    <div class="toc">
        1 <a href="#intro">Introduction</a><br />
		2 <a href="#requirements">Requirements</a><br />
        &nbsp;&nbsp;&nbsp;&nbsp;2.1 <a href="#requirements_for_package_author">Requirements for the Computer of the Package Author</a><br />
        &nbsp;&nbsp;&nbsp;&nbsp;2.2 <a href="#requirements_for_deployed_to">Requirements for the Computer to which a Package is to be Deployed</a><br />
		3 <a href="#configuration">Configuration</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;3.1 <a href="#configuring_using_package_editor">Option 1: Configuring using Package Editor</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;3.2 <a href="#configuring_manually">Option 2: Configuring manually</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;3.3 <a href="#ucd">Unicode Database</a><br />
		4 <a href="#creating_installer">Creating an Installer</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;4.1 <a href="#creating_installer_using_package_editor">Creating an Installer using Package Editor</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;4.2 <a href="#creating_installer_manually">Creating an Installer manually</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;4.3 <a href="#installer_ui">Installer User Interface</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;4.4 <a href="#debugging">Debugging the Installer</a><br />
		5 <a href="#package_xml_syntax">Package XML Syntax</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;5.1 <a href="#package">Package Element</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;5.2 <a href="#component">Component Element</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;5.3 <a href="#directory">Directory Element</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;5.4 <a href="#file">File Element</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;5.5 <a href="#inclusion_and_exclusion">Include and Exclude Elements</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;5.6 <a href="#environment">Environment Element</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;5.7 <a href="#environment_variable">Environment Variable Element</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;5.8 <a href="#path_directory">Environment Path Directory Element</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;5.9 <a href="#links">Links Element</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;5.10 <a href="#link_directory">Link Directory Element</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;5.11 <a href="#link">Link Element</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;5.12 <a href="#preinstall">Preinstall Element</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;5.13 <a href="#preinstall_include">Preinstall Include Element</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;5.14 <a href="#preinstall_run">Preinstall Run Element</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;5.15 <a href="#uninstall">Uninstall Element</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;5.16 <a href="#uninstall_run">Uninstall Run Element</a><br />
		6 <a href="#complete_example">Complete Package XML Example</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;6.1 <a href="#example_location">Example Package XML Location</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;6.2 <a href="#example_xml">Example Package XML</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;6.3 <a href="#creating_example_setup">Creating a Setup Program from the Example Package XML</a><br />
		7 <a href="#engine_variables">Installation Engine Variables</a><br />
		8 <a href="#installer_actions">Detailed Actions of the Installer</a><br />
		9 <a href="#uninstaller">Uninstaller</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;9.1 <a href="#uninstaller_user_interface">Uninstaller User Interface</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;9.2 <a href="#uninstaller_actions">Detailed Actions of the Uninstaller</a><br />
		10 <a href="#building_and_installing_wingstall">Building and Installing Wingstall from Sources</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;10.1 <a href="#building_wingstall">Building Wingstall from Sources</a><br />
		&nbsp;&nbsp;&nbsp;&nbsp;10.2 <a href="#installing_wingstall">Installing Wingstall Tools and Libraries Built from Sources</a><br />
		11 <a href="https://github.com/slaakko/wingstall-mod">Project's GitHub Site</a><br/>
		12 <a href="LICENSE.txt">License</a><br/>
    </div>

	<h2 id="intro">1 Introduction</h2>

	<p>
		Wingstall is an installer generator tool for Windows x64 written in C++.
		It generates a Visual C++ 2022 setup program that contains a binary installation package embedded 
		inside the setup executable as a Windows resource. 
		The binary installation package is generated by Wingstall from an XML package description file 
		created using a graphical <a href="package_editor.html">package editor</a>, or written manually by the package author.
		The binary package may be uncompressed, or compressed using the <a href="https://zlib.net/">ZLib</a> library. 
		Wingstall includes all required libraries except Boost libraries.
	</p>

	<h2 id="requirements">2 Requirements</h2>
	
	<h3 id="requirements_for_package_author">2.1 Requirements for the Computer of the Package Author</h3>
	
	<ul>
		<li>Windows 10 64-bit Operating System</li>
		<li>Microsoft Visual Studio 2022 Community Edition with 'Desktop development with C++' workload installed</li>
		<li><a href="https://www.boost.org/">Boost C++ Libraries</a> installed.
		If you need help building and installing Boost, take a look at
		<a href="https://levelup.gitconnected.com/the-definite-guide-on-compiling-and-linking-boost-c-libraries-for-visual-studio-projects-c79464d7282d">this</a>
		guide for example.
		</li>
		<li>Wingstall tools installed</li>
	</ul>
	
	<h3 id="requirements_for_deployed_to">2.2 Requirements for the Computer to which a Package is to be Deployed</h3>
	
	<ul>
		<li>Windows 10 64-bit Operating System with Visual C++ 2022 Runtime Libraries installed.<br/>
		The runtime libraries might already be installed to the computer to which a package is to be deployed, 
		but if this is not the case they can be downloaded from here:<br/>
		<a href="https://support.microsoft.com/en-us/topic/the-latest-supported-visual-c-downloads-2647da03-1eea-4433-9aff-95f26a218cc0">
		https://support.microsoft.com/en-us/topic/the-latest-supported-visual-c-downloads-2647da03-1eea-4433-9aff-95f26a218cc0</a>;<br/>
		The required libraries can be installed by running the <strong>vc_redist.x64.exe</strong> package.<br/>
		</li>
	</ul>
	
	<h2 id="configuration">3 Configuration</h2>
	
	<h3 id="configuring_using_package_editor">3.1 Option 1: Configuring using Package Editor</h3>
	
	<ul>
		<li>Start the package editor.</li>
		<li>Configuring using package editor is described <a href="package_editor.html#configuration">here.</a></li>
	</ul>
	
	<h3 id="configuring_manually">3.2 Option 2: Configuring manually</h3>
	
	<h4 id="wingstall_config">3.2.1 Wingstall Configuration</h3>
	
	<ul>
		<li>Open Windows Control Panel | System | Advanced system settings | Environment Variables and add a WINGSTALL_ROOT environment variable
			that contains a path to your wingstall directory (for example: 'C:\wingstall').
			The WINGSTALL_ROOT environment variable is used by the tools to locate the Unicode database and configuration.</li>
		<li>Add the '%WINGSTALL_ROOT%\bin' directory to your PATH.</li>
		<li>Open %WINGSTALL_ROOT%/config/configuration.xml<sup><a href="footnotes.html#footnote-1">1</a></sup> with a text editor (e.g. with notepad or Notepad++).</li>
		<li>The default Boost include directory is 'C:\boost\include\boost-1_74'. 
			Change the value of the <em>boostIncludeDir</em> attribute to contain path to your Boost include directory.</li>
		<li>The default Boost library directory is 'C:\boost\lib'. 
			Change the value of the <em>boostLibDir</em> attribute to contain path to your Boost library directory.</li>
		<li>The configured directory paths will be inserted to Visual C++ project files generated by Wingstall.</li>
	</ul>
	
	<h4 id="vs_config">3.2.2 Visual Studio Configuration</h3>
	
	<ul>
		<li>Open %WINGSTALL_ROOT%/config/build.props<sup><a href="footnotes.html#footnote-1">1</a></sup> with Visual Studio or a text editor (e.g. with notepad or Notepad++).</li>
		<li>Change the '&lt;BOOST_INCLUDE_DIR>C:\boost\include\boost-1_74&lt;/BOOST_INCLUDE_DIR>' element to contain path to your Boost include directory.</li>
		<li>Change the '&lt;BOOST_LIB_DIR>C:\boost\lib&lt;/BOOST_LIB_DIR>' element to contain path to your Boost library directory.</li>
		<li>The configured directory paths are in effect when building the 'wingstall.sln' solution with Visual Studio.
	</ul>
	
	<h3 id="ucd">3.3 Unicode Database</h3>
	
	<p>
		If the files <strong>%WINGSTALL_ROOT%/unicode/wingstall_ucd.bin</strong> and/or <strong>%WINGSTALL_ROOT%/unicode/wingstall_ucd.deflate.bin</strong> are missing,
		you can generate them with the <strong>make_wingstall_ucd</strong> tool:
		
		<ul>
			<li>If you don't have binaries in your %WINGSTALL_ROOT%/bin<sup><a href="footnotes.html#footnote-1">1</a></sup> directory, 
			you must first <a href="#building_and_installing_wingstall">build</a> the tools from sources.</li>
			<li><a href="ucd.html">Here</a> are instructions how to generate the Unicode database with the <strong>make_wingstall_ucd</strong> tool.
		</ul>
	</p>

	<h2 id="creating_installer">4 Creating an Installer</h2>
	
	<h3 id="creating_installer_using_package_editor">4.1 Creating an Installer using Package Editor</h3>
	
	<p>
		Creating an installer using package editor is described in <a href="package_editor.html">this document</a>.
	</p>

	<h3 id="creating_installer_manually">4.2 Creating an Installer manually</h3>
	
	<p>
		Creating an installer for an application manually requires these steps:
	</p>
	
	<ol>
		<li>creating a <a href="#package_xml_syntax">package XML</a> file with Visual Studio or a UTF-8-enabled text editor such as Notepad++.</li>
		<li>running <strong>wingstall -v --create-package <em>package</em>.xml</strong>
		<li>running <strong>wingstall -v --make-setup <em>package</em>.bin</strong>
		<li>compiling the generated <strong>setup.vcxproj</strong> with Visual Studio</li>
	</ol>
	
	<h3 id="installer_ui">4.3 Installer User Interface</h3>
	
	<p>
		The resulting installer will look like this:
	</p>
	
	<img src="image/installer.png"/>

	<ul>
		<li>The 'Containing directory' is the directory that will contain the installation directory. 
			It can be changed by clicking the '...' button on the right, or by typing a new value to the text box.
		</li>
		<li>
			The 'Installation directory' is the directory that will be created by the installer and will contain 
			all directories and files in the package.
		</li>
		<li>
			The 'Status' shows current installation status.
		</li>
		<li>
			The 'Component' shows current component being installed.
		</li>
		<li>
			The 'File' shows current file being read from the package and written to user's file system.
		</li>
		<li>
			'Progress' shows installation progress.
		</li>
	</ul>
	
	<h3 id="debugging">4.4 Debugging the Installer</h3>
	
	<p>
		The generated installer application requires Administrator privileges because it writes to Windows registry under the HKEY_LOCAL_MACHINE key.
		Therefore if you want to debug the setup application, you must first start Visual Studio with administrator privileges:
		right-click the Visual Studio icon in the task bar, right-click the Visual Studio 2022 on the opened menu and select 'Run as Administrator' from the opened menu.
		Then you can open the <strong>setup.vcxproj</strong> and start debugging it.
	</p>

	<h2 id="package_xml_syntax">5 Package XML Syntax</h2>

	<p>
		The package XML file will contain:
		<ul>
		<li>general information about the application to be installed</li>
		<li>information about what will be included in the binary package (<em>package</em>.bin file)</li>
		<li>information about the environment variables and shortcuts to be created when the package is installed to the target computer</li>
		</ul>
	</p>
	
	<p>
		When the package XML is compiled with <strong>wingstall --create-package</strong> command, the resulting <em>package</em>.bin will contain:
		<ul>
			<li>knowledge of the compression method used (<strong>none</strong>, <strong>deflate</strong>, <strong>bzip2</strong>)</li>
			<li>compressed metadata about files, directories, environment variables and links; this is called the package <em>index</em></li>
			<li>compressed contents of files; this is called the package <em>data</em></li>
		</ul>
	</p>

    <h3 id="package">5.1 Package Element</h3>

	<p>
		The <tt>package</tt> element is the root element of the package XML file.
		It has name and other attributes some of which are mandatory and some not.
		The <tt>package</tt> element may contain one or more <tt>component</tt> elements, 
		and optional (zero or one) <tt>environment</tt>, <tt>links</tt>, <tt>preinstall</tt> and <tt>uninstall</tt> elements.
	</p>

	<h4>Syntax</h4>

	<span class="syntax">
		&lt;package name="<span class="attribute">package_name</span>" <span class="attribute">package_attributes</span>><br/>
		<div class="indent"><span class="attribute">package_content</span></div>
		&lt;/package>
	</span>

	<h4>Cardinality</h4>
	
	<span class="cardinality">1</span>

	<h4>Parent</h4>
	
	<span class="parent">-</span>

	<h4>Children</h4>
	
	<span class="children">component | environment | links | preinstall | uninstall</span>
	
	<h4>Example</h4>

	<span class="syntax">
		&lt;?xml version="1.0" encoding="utf-8"?><br/>
		&lt;package<br/>
		<div class="indent">name="example"</div>
		<div class="indent">appName="Example"</div>
		<div class="indent">version="1.0.0"</div>
		<div class="indent">publisher="Joe Coder"</div>
		<div class="indent">sourceRootDir="../../source"</div>
		<div class="indent">targetRootDir="C:/example"</div>
		<div class="indent">compression="deflate"</div>
		<div class="indent">iconFilePath="$TARGET_ROOT_DIR$/bin/example.ico"</div>
		<div class="indent">includeUninstaller="true"></div>
		<div class="indent"><span class="attribute">...</span></div>
		&lt;/package><br/>
	</span>
	
	<h4>Package Attributes</h4>

    <table>
		<tr>
			<th>name</th>
			<th>description</th>
			<th>mandatory</th>
			<th>default value</th>
		</tr>
        <tr>
            <td class="content">name</td>
            <td>the name of the package</td>
			<td>true</td>
			<td></td>
        </tr>
		<tr>
			<td class="content">appName</td>
			<td>the name of the application</td>
			<td>true</td>
			<td></td>
		</tr>
		<tr>
			<td class="content">version</td>
			<td>application version (major.minor[.build])</td>
			<td>false</td>
			<td><strong>1.0.0</strong></td>
		</tr>
		<tr>
			<td class="content">publisher</td>
			<td>the publisher of the application</td>
			<td>false</td>
			<td></td>
		</tr>
		<tr>
			<td id="srcRootDir" class="content">sourceRootDir</td>
			<td>path to the top level directory that contains directories and files included in the package;
			if this is a relative path, it is taken relative to the directory that contains the package XML file</td>
			<td>true</td>
			<td></td>
		</tr>
		<tr>
			<td class="content">targetRootDir</td>
			<td>absolute path to the installation directory in the target file system 
				(can be changed by the user at installation time)</td>
			<td>true</td>
			<td></td>
		</tr>
		<tr>
			<td class="content">compression</td>
			<td>compression method: <strong>none</strong> - no compression, 
				<strong>deflate</strong> - compression using the zlib library, 
				<strong>bzip2</strong> - compression using the bzip2 library</td>
			<td>false</td>
			<td><strong>none</strong></td>
		</tr>
		<tr>
			<td class="content">iconFilePath</td>
			<td>path to the application icon file (.ico) in the target file system; 
				you can use <a href="#engine_variables">engine variables</a> as path components</td>
			<td>false</td>
			<td></td>
		</tr>
		<tr>
			<td class="content">includeUninstaller</td>
			<td><strong>true</strong> - include uninstaller program in the package and 
				install it to the <em>targetRootDir</em> directory;
				<strong>false</strong> - do not include uninstaller program</td>
			<td>false</td>
			<td><strong>true</strong></td>
		</tr>
		<tr>
			<td class="content">id</td>
			<td>the product ID of the application; the value should be an UUID without braces</td>
			<td>false</td>
			<td>random UUID, e.g. <strong>00d25835&#8209;6305&#8209;4380&#8209;bba4&#8209;87d6f80e12df</strong></td>
		</tr>
    </table>

	<h3 id="component">5.2 Component Element</h3>
	
	<p>
		The contents of the package is organized as components. Each component may contain one or more directories and one or more files.
	</p>
	
	<p>
		The name of the component combined with the full path of a current directory is shown in the <strong>component</strong> label 
		of the installer window when the package is being installed.
	</p>
	
	<h4>Syntax</h4>
	
	<span class="syntax">
		&lt;component name="<span class="attribute">component_name</span>"<br/>
			<div class="indent"><span class="attribute">component_content</span></div>
		&lt;/component>
	</span>

	<h4>Cardinality</h4>
	
	<span class="cardinality">0-n</span>

	<h4>Parent</h4>
	
	<span class="parent">package</span>

	<h4>Children</h4>
	
	<span class="children">directory | file</span>

	<h4>Example</h4>
	
	<span class="syntax">
		&lt;component<br/>
			<div class="indent">name="binaries"></div>
			<div class="indent">...</div>
		&lt;/component>
	</span>
	
	<p>
		The package will contain a <em>binaries</em> component.
	</p>
	
	<h4>Component Attributes</h4>

    <table>
		<tr>
			<th>name</th>
			<th>description</th>
			<th>mandatory</th>
			<th>default value</th>
		</tr>
        <tr>
            <td class="content">name</td>
            <td>the name of the component</td>
			<td>true</td>
			<td></td>
        </tr>
	</table>

	<h3 id="directory">5.3 Directory Element</h3>
	
	<p>
		A <tt>directory</tt> element has a <em>name</em> attribute 
		that should correspond to a physical directory with the same name in the source file system.
		A physical path of a <tt>directory</tt> element contained by a <tt>component</tt> element 
		consists of the value of the <em>sourceRootDir</em> attribute of the
		<tt>package</tt> element combined with the <em>name</em> attribute of the <tt>directory</tt> element.
		A physical path of a <tt>directory</tt> element contained by another <tt>directory</tt> element is the physical path
		of the parent <tt>directory</tt> element combined with the <em>name</em> attribute of that child <tt>directory</tt> element.
	</p>
	
	<p>
		By default all subdirectories and files contained by a directory are included in the package. 
		Finer control of what will and will not be included can be specified using the 
		<a href="#inclusion_and_exclusion"><tt>include</tt> and <tt>exclude</tt></a> elements.
	</p>
	
	<h4>Syntax</h4>
	
	<span class="syntax">
		&lt;directory name="<span class="attribute">directory_name</span>"<br/>
		<div class="indent"><span class="attribute">directory_content</span></div>
		&lt;/directory>
	</span>

	<h4>Cardinality</h4>
	
	<span class="cardinality">0-n</span>
	
	<h4>Parent</h4>
	
	<span class="parent">component | directory</span>

	<h4>Children</h4>
	
	<span class="children">directory | include | exclude</span>

	<h4>Example</h4>
	
	<span class="syntax">
		&lt;component<br/>
			<div class="indent">name="binaries"></div>
			<div class="indent">&lt;directory name="bin"/></div>
		&lt;/component>
	</span>
	
	<p>
		The <em>binaries</em> component consists of all directories and files contained by the <em>bin</em> directory.
	</p>
	
	<h4>Directory Attributes</h4>

    <table>
		<tr>
			<th>name</th>
			<th>description</th>
			<th>mandatory</th>
			<th>default value</th>
		</tr>
        <tr>
            <td class="content">name</td>
            <td>the name of the directory</td>
			<td>true</td>
			<td></td>
        </tr>
	</table>
	
	<h3 id="file">5.4 File Element</h3>
	
	<p>
		A <tt>file</tt> element has a <em>name</em> attribute 
		that should correspond to a physical file with the same name in the <a href="#srcRootDir"><em>sourceRootDir</em></a> directory.
		The name can also be a pattern that is matched against file names in the <a href="#srcRootDir"><em>sourceRootDir</em></a> directory.
	</p>
	
	<h4>Syntax</h4>
	
	<span class="syntax">
		&lt;file name="<span class="attribute">file_name</span>"/>
	</span>

	<h4>Cardinality</h4>
	
	<span class="cardinality">0-n</span>
	
	<h4>Parent</h4>
	
	<span class="parent">component</span>

	<h4>Example</h4>
	
	<span class="syntax">
		&lt;component<br/>
			<div class="indent">name="root"></div>
			<div class="indent">&lt;file name="wingstall.sln"/></div>
		&lt;/component>
	</span>
	
	<p>
		The <em>root</em> component consists of a wingstall.sln file.
	</p>
	
	<h4>File Attributes</h4>

    <table>
		<tr>
			<th>name</th>
			<th>description</th>
			<th>mandatory</th>
			<th>default value</th>
		</tr>
        <tr>
            <td class="content">name</td>
            <td>the name of the file; can be a pattern; pattern '*' means 'all'; pattern '*.txt' matches all file names ending with '.txt'</td>
			<td>true</td>
			<td></td>
        </tr>
	</table>

	<h3 id="inclusion_and_exclusion">5.5 Include and Exclude Elements</h3>

	<p>
		The <tt>include </tt> and <tt>exclude</tt> elements provide a mechanism to selectively include and exclude files and directories.
	</p>

	<p>
		The names of the files and directories directly contained by a physical source directory are matched against 
		the <tt>include</tt> and <tt>exclude</tt> child elements contained by a corresponding <tt>directory</tt> or <tt>include</tt> element.
		The list of direct <tt>include</tt> and <tt>exclude</tt> child elements are processed sequentially. By default each file is included.
		Then, if the file name matches an <tt>&lt;exclude file=<em>"pattern"</em>/></tt> element, it will be excluded. 
		But if it later in the same list matches an <tt>&lt;include file=<em>"pattern"</em>/></tt> element, it will be included, however.
		The last matching <tt>include file</tt> or <tt>exclude file</tt> element will stay in effect.
	</p>
	
	<p>
		The same goes for subdirectory names: by default each subdirectory is included. 
		Then, if the subdirectory name matches an <tt>&lt;exclude dir=<em>"pattern"</em>/></tt> element, it will be excluded. 
		But if it later in the same list matches an <tt>&lt;include dir=<em>"pattern"</em>/></tt> element, it will be included, however.
		The last matching <tt>include dir</tt> or <tt>exclude dir</tt> element will stay in effect.
	</p>
	
	<p>
		This means that if you want to selectively <strong>include</strong> files, you should first have an <tt>&lt;exclude file="*"/></tt> element, and then have
		<tt>&lt;include file=<em>"file_name"</em>/></tt> element for each file to include.
	</p>
	
	<p>
		Again the same goes for selectively <strong>including</strong> subdirectories: you should first have an <tt>&lt;exclude dir="*"/></tt> element, and then have
		<tt>&lt;include dir=<em>"dir_name"</em>/></tt> element for each subdirectory to include.
	</p>

	<p>
		If you want only to selectively <strong>exclude</strong> files, you should have <tt>&lt;exclude file=<em>"pattern"</em>/></tt> element(s) matching those files,
		and if you want only to selectively <strong>exclude</strong> subdirectories, you should have <tt>&lt;exclude dir=<em>"pattern"</em>/></tt> element(s) matching those subdirectories.
	</p>
	
	<p>
		The <tt>exclude</tt> elements can have an additional attribute named <em>cascade</em> that should have a Boolean value.
		If cascade="<strong>true</strong>", the name/pattern is applied also in the subdirectories and descendant directories recursively.
	</p>

	<p>
		Note: <strong><em>package</em>.index.xml</strong> file generated by the <strong>wingstall --create-package</strong> command 
		lists all directories and files included in the package.
	</p>

	<h4>Syntax</h4>
	
	<span class="syntax">
		&lt;include file="<span class="attribute">file_name</span>"/><br/>
		&lt;exclude file="<span class="attribute">file_name</span>" [cascade="true" | cascade="false"]/><br/>
		&lt;include dir="<span class="attribute">dir_name</span>"/><br/>
		&lt;exclude dir="<span class="attribute">dir_name</span>" [cascade="true" | cascade="false"]/><br/>
	</span>
	
	<h4>Cardinality</h4>
	
	<span class="cardinality">0-n</span>

	<h4>Parent</h4>
	
	<span class="parent">directory | include</span>

	<h4>Children (include)</h4>
	
	<span class="children">include | exclude</span>

	<h4>Examples</h4>
	
	<h5>Example 1</h5>
	
	<span class="syntax">
		&lt;component name="libraries"><br/>
		<div class="indent">&lt;directory name="lib"></div>
		<div class="double_indent">&lt;exclude dir="*"/></div>
		<div class="double_indent">&lt;exclude file="*"/></div>
		<div class="double_indent">&lt;include file="*.lib"/></div>
		<div class="indent">&lt;/directory></div>
		&lt;/component>
	</span>
	
	<p>
		Include "*.lib" files contained directly by the "lib" directory. Exclude all other files and exlude all subdirectories under the "lib" directory.
	</p>
	
	<h5>Example 2</h5>
	
	<span class="syntax">
		&lt;component name="system"><br/>
		<div class="indent">&lt;directory name="system"></div>
		<div class="double_indent">&lt;exclude dir="*"/></div>
		<div class="double_indent">&lt;include dir="lib"></div>
		<div class="triple_indent">&lt;exclude dir="cpp"/></div>
		<div class="double_indent">&lt;/include></div>
		<div class="indent">&lt;/directory></div>
		&lt;/component>
	</span>
	
	<p>
		Include all files contained directly by the "system" directory.
		Include only the "system/lib" subdirectory and all files and directories contained by the "system/lib" directory excluding the "system/lib/cpp" directory.
	</p>
	
	<h5>Example 3</h5>
	
	<span class="syntax">
		&lt;component name="sources"><br/>
		<div class="indent">&lt;directory  name="src"></div>
		<div class="double_indent">&lt;exclude dir="x64" cascade="true"/></div>
		<div class="double_indent">&lt;exclude dir="Debug" cascade="true"/></div>
		<div class="double_indent">&lt;exclude dir="Release" cascade="true"/></div>
		<div class="indent">&lt;/directory></div>
		&lt;/component>
	</span>

	<p>
		Include all files and directories recursively under the "src" directory except directories that have name "x64", "Debug" or "Release".
	</p>
	
	<h4>Include and Exclude Attributes</h4>

    <table>
		<tr>
			<th>name</th>
			<th>description</th>
			<th>mandatory</th>
			<th>default value</th>
		</tr>
        <tr>
            <td class="content">file | dir</td>
            <td>the name of the file or subdirectory to include or exclude; can be a pattern;<br/>
			pattern '*' means 'all', pattern '*.exe' matches all names ending with '.exe';<br/>
			note: the name or pattern may not contain forward slash '/' or backslash '\' characters</td>
			<td>true</td>
			<td></td>
        </tr>
		<tr>
			<td class="content">cascade</td>
			<td>for <tt>exclude</tt> elements: if cascade=<strong>true</strong>, the name/pattern is applied also in the subdirectories and descendant directories recursively</td>
			<td>false</td>
			<td><strong>false</strong></td>
		</tr>
	</table>

	<h3 id="environment">5.6 Environment Element</h3>
	
	<p>
		The <tt>environment</tt> element is an optional element that may contain environment variables and path directories.
	</p>
	
	<h4>Syntax</h4>
	
	<span class="syntax">
		&lt;environment><br/>
		<div class="indent"><span class="attribute">environment_content</span></div>
		&lt;/environment><br/>
	</span>

	<h4>Cardinality</h4>
	
	<span class="cardinality">0-1</span>

	<h4>Parent</h4>
	
	<span class="parent">package</span>

	<h4>Children</h4>
	
	<span class="children">variable | pathDirectory</span>

	<h4>Example</h4>
	
	<span class="syntax">
	&lt;environment>
	<div class="indent">...</div>
	&lt;/environment>
	</span>
	
	<h3 id="environment_variable">5.7 Environment Variable Element</h3>
	
	<p>
		An environment variable has a name and a value. The value of the environment variable may have <a href="#engine_variables">engine variables</a> as
		path components. The value is expanded at installation time.
		The environment variable is created as a system variable for all users.
	</p>
	
	<h4>Syntax</h4>
	
	<span class="syntax">
		&lt;variable
		<div class="indent">name=<span class="attribute">"environment_variable_name"</span></div>
		<div class="indent">value=<span class="attribute">"environment_variable_value"</span>/></div>
	</span>
	
	<h4>Cardinality</h4>
	
	<span class="cardinality">0-n</span>

	<h4>Parent</h4>
	
	<span class="parent">environment</span>

	<h4>Example</h4>
	
	<span class="syntax">
	&lt;environment>
	<div class="indent">&lt;variable name="EXAMPLE_ROOT" value="$TARGET_ROOT_DIR$"/></div>
	&lt;/environment>
	</span>
	
	<p>
		Creates an environment variable whose name is 'EXAMPLE_ROOT', and whose value is path to the installation directory, to the target computer.
	</p>
	
	<h4>Environment Variable Attributes</h4>

	<table>
		<tr>
			<th>name</th>
			<th>description</th>
			<th>mandatory</th>
			<th>default value</th>
		</tr>
        <tr>
            <td class="content">name</td>
            <td>the name of an environment variable to create to the target computer</td>
			<td>true</td>
			<td></td>
        </tr>
        <tr>
            <td class="content">value</td>
            <td>the value of the environment variable; you can use <a href="#engine_variables">engine variables</a> as path components</td>
			<td>true</td>
			<td></td>
        </tr>
	</table>

	<h3 id="path_directory">5.8 Environment Path Directory Element</h3>
	
	<p>
		A <tt>pathDirectory</tt> element has a value attribute. 
		The value may contain <a href="#engine_variables">engine variables</a> as path components that are expanded at installation time.
		The value of the path directory is appended to the system PATH environment variable for all users.
	</p>
	
	<h4>Syntax</h4>
	
	<span class="syntax">
		&lt;pathDirectory
		<div class="indent">value=<span class="attribute">"path_directory_value"</span>/></div>
	</span>
	
	<h4>Cardinality</h4>
	
	<span class="cardinality">0-n</span>

	<h4>Parent</h4>
	
	<span class="parent">environment</span>
	
	<h4>Example</h4>
	
	<span class="syntax">
	&lt;environment>
		<div class="indent">&lt;pathDirectory value="$TARGET_ROOT_DIR$/bin"/></div>
	&lt;/environment>
	</span>
	
	<p>
		Appends path to the <em>bin</em> subdirectory of the installation directory to the system PATH.
	</p>
	
	<h4>Environment Path Directory Attributes</h4>
	
	<table>
		<tr>
			<th>name</th>
			<th>description</th>
			<th>mandatory</th>
			<th>default value</th>
		</tr>
        <tr>
            <td class="content">value</td>
            <td>the value should be an absolute directory path to be appended to the PATH environment variable in the target computer;
			you can use <a href="#engine_variables">engine variables</a> as path components</td>
			<td>true</td>
			<td></td>
        </tr>
	</table>

	<h3 id="links">5.9 Links Element</h3>
	
	<p>
		The <tt>links</tt> element is an optional element that may contain link directories and link files.
	</p>
	
	<h4>Syntax</h4>
	
	<span class="syntax">
		&lt;links><br/>
		<div class="indent"><span class="attribute">links_content</span></div>
		&lt;/links><br/>
	</span>

	<h4>Cardinality</h4>
	
	<span class="cardinality">0-1</span>

	<h4>Parent</h4>
	
	<span class="parent">package</span>

	<h4>Children</h4>
	
	<span class="children">linkDirectory | link</span>

	<h4>Example</h4>
	
	<span class="syntax">
	&lt;links>
	<div class="indent">...</div>
	&lt;/links>
	</span>
	
	<h3 id="link_directory">5.10 Link Directory Element</h3>
	
	<p>
		The <tt>linkDirectory</tt> element has a path attribute.
		The path may contain <a href="#engine_variables">engine variables</a> as components that are expanded at installation time. 
		The installation engine creates this directory to the target file system if it does not already exist.
	</p>
	
	<h4>Syntax</h4>
	
	<span class="syntax">
		&lt;linkDirectory
			<div class="indent">path=<span class="attribute">"link_directory_path"</span>/></div>
	</span>
	
	<h4>Cardinality</h4>
	
	<span class="cardinality">0-n</span>

	<h4>Parent</h4>
	
	<span class="parent">links</span>
	
	<h4>Example</h4>
	
	<span class="syntax">
		&lt;linkDirectory 
		<div class="indent">path="$START_MENU_PROGRAMS_FOLDER$/Example"/></div>
	</span>

	<p>
		Creates an 'Example' subdirectory under the 'Programs' folder of the Start menu.
	</p>

	<h4>Link Directory Attributes</h4>
	
	<table>
		<tr>
			<th>name</th>
			<th>description</th>
			<th>mandatory</th>
			<th>default value</th>
		</tr>
        <tr>
            <td class="content">path</td>
            <td>the value should be an absolute directory path to be created in the target computer;
				you can use <a href="#engine_variables">engine variables</a> as path components</td>
			<td>true</td>
			<td></td>
        </tr>
	</table>
	
	<h3 id="link">5.11 Link Element</h3>
	
	<p>
		The <tt>link</tt> element represents a shortcut file (.lnk) to be created to the target computer.
		It has many attributes some of which are mandatory and some not.
		The values of those attributes are expanded at installation time.
	</p>
	
	<h4>Syntax</h4>
	
	<span class="syntax">
		&lt;link
		<div class="indent"><span class="attribute">link_attributes</span>/></div>
	</span>
	
	<h4>Cardinality</h4>
	
	<span class="cardinality">0-n</span>

	<h4>Parent</h4>
	
	<span class="parent">links</span>
	
	<h4>Example</h4>
	
	<span class="syntax">
		&lt;link 
		<div class="indent">linkFilePath="$DESKTOP_FOLDER$/Example.lnk"</div>
		<div class="indent">path="$TARGET_ROOT_DIR$/bin/hello.exe"</div>
		<div class="indent">workingDirectory="$TARGET_ROOT_DIR$/bin"</div>
		<div class="indent">description="Hello World Example"</div>
		<div class="indent">iconPath="$TARGET_ROOT_DIR$/bin/hello.exe"</div>
		<div class="indent">iconIndex="0"/></div>
	</span>
	
	<p>
		Creates a shortcut named 'Example' to the user's desktop. 
		The shortcut points to the 'hello.exe' that is located in the 'bin' subdirectory of the installation directory.
	</p>
	
	<h4>Link Attributes</h4>

	<p>
		You can use <a href="#engine_variables">engine variables</a> as path components in the link attribute values.
	</p>

	<table>
		<tr>
			<th>name</th>
			<th>description</th>
			<th>mandatory</th>
			<th>default value</th>
		</tr>
        <tr>
            <td class="content">linkFilePath</td>
            <td>the value should be an absolute shortcut (.lnk) file path to be created in the target file system</td>
			<td>true</td>
			<td></td>
        </tr>
		<tr>
            <td class="content">path</td>
            <td>the value should be an absolute path to a file or directory in the target file system that the shortcut points to</td>
			<td>true</td>
			<td></td>
		</tr>
		<tr>
            <td class="content">arguments</td>
            <td>if the shortcut is a link to an executable, this specifies command line arguments that the executable is given when executed</td>
			<td>false</td>
			<td></td>
		</tr>
		<tr>
            <td class="content">workingDirectory</td>
            <td>if the shortcut is a link to an executable, this is the working directory that the executable is given when executed</td>
			<td>false</td>
			<td>the parent directory of <em>path</em></td>
		</tr>
		<tr>
            <td class="content">description</td>
            <td>the description of the shortcut; shown when the user hovers the mouse cursor on the shortcut or shows properties of the shortcut</td>
			<td>false</td>
			<td></td>
		</tr>
		<tr>
            <td class="content">iconPath</td>
            <td>path to a file that is an icon file (.ico) or contains (.exe or .dll) an icon for the shortcut</td>
			<td>false</td>
			<td></td>
		</tr>
		<tr>
            <td class="content">iconIndex</td>
            <td>index of the icon to show</td>
			<td>false</td>
			<td><strong>0</strong></td>
		</tr>
	</table>

	<h3 id="preinstall">5.12 Preinstall Element</h3>

	<p>
		The <tt>preinstall</tt> element is an optional element that may contain <tt>include</tt> and <tt>run</tt> elements.
		The preinstall component is associated with a directory that is created under the installation directory.
		It is called the <em>preinstall directory</em>.
		It has a unique random name, and its absolute path is exposed as the <strong>$PREINSTALL_DIR$</strong> engine variable.
		The preinstall component can be used for checking installation prerequisites before the main installation is started.
	</p>
	
	<p>
		After the executables specified as <tt>include</tt> elements has been copied to the preinstall directory and then commands specified as <tt>run</tt> 
		elements have been executed, the preinstall directory is removed.
	</p>
	
	<h4>Syntax</h4>
	
	<span class="syntax">
		&lt;preinstall><br/>
		<div class="indent"><span class="attribute">preinstall_content</span></div>
		&lt;/preinstall><br/>
	</span>

	<h4>Cardinality</h4>
	
	<span class="cardinality">0-1</span>

	<h4>Parent</h4>
	
	<span class="parent">package</span>

	<h4>Children</h4>
	
	<span class="children">include | run</span>

	<h4>Example</h4>
	
	<span class="syntax">
	&lt;preinstall>
	<div class="indent">...</div>
	&lt;/preinstall>
	</span>
	
	<h3 id="preinstall_include">5.13 Preinstall Include Element</h3>
	
	<p>
		The <tt>include</tt> element that is the child of the <tt>preinstall</tt> element represents an executable file that is 
		included in the installation package and copied to the preinstall directory before the main installation is started.
		It has a <em>filePath</em> attribute that should contain an absolute path to a file in the source file system.
		The  file can be an executable file (.exe or .dll), or a data file.
	</p>
	
	<p>
		Note: if the <tt>include</tt>d file is an executable (.exe) that depends on dynamic libraries (.dll), those libraries should be <tt>include</tt>d too.
	</p>
	
	<h4>Syntax</h4>
	
	<span class="syntax">
		&lt;include
		<div class="indent">filePath=<span class="attribute">"preinstall_include_file_path"/></span></div>
	</span>
	
	<h4>Cardinality</h4>
	
	<span class="cardinality">0-n</span>

	<h4>Parent</h4>
	
	<span class="parent">preinstall</span>

	<h4>Example</h4>

	<span class="syntax">
		&lt;preinstall>
		<div class="indent">&lt;include filePath="C:\cmajorm\cmajor\installation\x64\Release\checkcmajor.exe"/></div>
		&lt;/preinstall>
	</span>
	
	<p>
		Include file 'C:\cmajorm\cmajor\installation\x64\Release\checkcmajor.exe' 
		in the package and copy it to the preinstall directory at installation time.
	</p>
	
	<h4>Preinstall Include Attributes</h4>

	<table>
		<tr>
			<th>name</th>
			<th>description</th>
			<th>mandatory</th>
			<th>default value</th>
		</tr>
        <tr>
            <td class="content">filePath</td>
            <td>an absolute path to a file in the source file system to be installed to the preinstall directory of the target file system; note: cannot use wildcards in this</td>
			<td>true</td>
			<td></td>
        </tr>
	</table>
	
	<h3 id="preinstall_run">5.14 Preinstall Run Element</h3>
	
	<p>
		A <tt>run</tt> element that is a child of the <tt>preinstall</tt> element represents 
		a command to be executed by the installation engine before the main installation is started.
	</p>
	
	<h4>Syntax</h4>
	
	<span class="syntax">
		&lt;run
		<div class="indent">command=<span class="attribute">"command with possible arguments"/></span></div>
	</span>
	
	<h4>Cardinality</h4>
	
	<span class="cardinality">0-n</span>

	<h4>Parent</h4>
	
	<span class="parent">preinstall</span>

	<h4>Example</h4>

	<span class="syntax">
		&lt;preinstall>
		<div class="indent">&lt;run command="$PREINSTALL_DIR$\checkcmajor"/></div>
		&lt;/preinstall>
	</span>
	
	<p>
		Execute program 'checkcmajor' that is included and installed to the preinstall directory. 
		If the program returns other exit code than zero, the installation is not allowed to continue.
	</p>
	
	<h4>Preinstall Run Attributes</h4>

	<table>
		<tr>
			<th>name</th>
			<th>description</th>
			<th>mandatory</th>
			<th>default value</th>
		</tr>
        <tr>
            <td class="content">command</td>
            <td>command line (program and arguments) to be executed before the main installation; you can use <a href="#engine_variables">engine variables</a> as path components;
			note: if the command is not found or returns a nonzero exit code, installation is not allowed to continue and 
			an error message is reported to the user</td>
			<td>true</td>
			<td></td>
        </tr>
	</table>

	<h3 id="uninstall">5.15 Uninstall Element</h3>
	
	<p>
		The <tt>uninstall</tt> element is an optional element that may contain <tt>run</tt> elements.
		The uninstaller program runs these commands before other uninstallation actions take place.
	</p>
	
	<h4>Syntax</h4>
	
	<span class="syntax">
		&lt;uninstall><br/>
		<div class="indent"><span class="attribute">uninstall_content</span></div>
		&lt;/uninstall><br/>
	</span>

	<h4>Cardinality</h4>
	
	<span class="cardinality">0-1</span>

	<h4>Parent</h4>
	
	<span class="parent">package</span>

	<h4>Children</h4>
	
	<span class="children">run</span>

	<h4>Example</h4>
	
	<span class="syntax">
	&lt;uninstall>
	<div class="indent">...</div>
	&lt;/uninstall>
	</span>

	<h3 id="uninstall_run">5.16 Uninstall Run Element</h3>
	
	<p>
		The <tt>run</tt> element that is the child of the <tt>uninstall</tt> element represents a command that should be executed before 
		other uninstallation actions take place.
	</p>
	
	<h4>Syntax</h4>
	
	<span class="syntax">
		&lt;run
		<div class="indent">command=<span class="attribute">"command with possible arguments"/></span></div>
	</span>
	
	<h4>Cardinality</h4>
	
	<span class="cardinality">0-n</span>

	<h4>Parent</h4>
	
	<span class="parent">uninstall</span>

	<h4>Example</h4>

	<span class="syntax">
		&lt;uninstall>
		<div class="indent">&lt;run command="closecmpms"/></div>
		&lt;/uninstall>
	</span>
	
	<p>
		Run program 'closecmpms' at uninstallation time. 
	</p>
	
	<h4>Uninstall Run Attributes</h4>

	<table>
		<tr>
			<th>name</th>
			<th>description</th>
			<th>mandatory</th>
			<th>default value</th>
		</tr>
        <tr>
            <td class="content">command</td>
            <td>command line (program and arguments) to be executed before main uninstallation; you can use <a href="#engine_variables">engine variables</a> as path components;
			if the command is not found or returns a nonzero exit code, uninstallation is allowed to continue but an error message is added to the uninstallation log window</td>
			<td>true</td>
			<td></td>
        </tr>
	</table>
	
	<h2 id="complete_example">6 Complete Package XML Example</h2>
	
	<h3 id="example_location">6.1 Example Package XML Location</h3>
	
	<p>
		The example package XML is in the file %WINGSTALL_ROOT%/example/setup/deflate/example.xml<sup><a href="footnotes.html#footnote-1">1</a></sup>:
	</p>
	
	<h3 id="example_xml">6.2 Example Package XML</h3>
	
	<span class="syntax">
	&lt;?xml version="1.0" encoding="utf-8"?><br/>
	&lt;package<br/>
	<div class="indent">name="example"</div>
	<div class="indent">appName="Example"</div>
	<div class="indent">version="1.0.0"</div>
	<div class="indent">publisher="Joe Coder"</div>
	<div class="indent">sourceRootDir="../../source/example"</div>
	<div class="indent">targetRootDir="C:/example"</div>
	<div class="indent">compression="deflate"</div>
	<div class="indent">iconFilePath="$TARGET_ROOT_DIR$/bin/example.ico"</div>
	<div class="indent">includeUninstaller="true"></div>
	<div class="indent">&lt;component name="binaries"></div>
	<div class="double_indent">&ltdirectory name="bin"/></div>
	<div class="indent">&lt;/component></div>
	<div class="indent">&lt;component name="libraries"></div>
	<div class="double_indent">&lt;directory name="lib"></div>
	<div class="triple_indent">&lt;exclude dir="*"/></div>
	<div class="triple_indent">&lt;exclude file="*"/></div>
	<div class="triple_indent">&lt;include file="*.lib"/></div>
	<div class="double_indent">&lt;/directory></div>
	<div class="indent">&lt;/component></div>
	<div class="indent">&lt;component name="documentation"></div>
	<div class="double_indent">&lt;directory name="doc"></div>
	<div class="triple_indent">&lt;exclude dir="private"/></div>
	<div class="triple_indent">&lt;exclude file="file.txt"/></div>
	<div class="double_indent">&lt;/directory></div>
	<div class="indent">&lt;/component></div>
	<div class="indent">&lt;environment></div>
	<div class="double_indent">&lt;variable name="EXAMPLE_ROOT" value="$TARGET_ROOT_DIR$"/></div>
	<div class="double_indent">&lt;pathDirectory value="$TARGET_ROOT_DIR$/bin"/></div>
	<div class="indent">&lt;/environment></div>
	<div class="indent">&lt;links></div>
	<div class="double_indent">&lt;linkDirectory</div>
	<div class="triple_indent">path="$START_MENU_PROGRAMS_FOLDER$/Example"/></div>
	<div class="double_indent">&lt;link</div>
	<div class="triple_indent">linkFilePath="$START_MENU_PROGRAMS_FOLDER$/Example/Example.lnk"</div>
	<div class="triple_indent">path="$TARGET_ROOT_DIR$/bin/example.exe"</div>
	<div class="triple_indent">workingDirectory="$TARGET_ROOT_DIR$/bin"</div>
	<div class="triple_indent">description="Hello World Example"</div>
	<div class="triple_indent">iconPath="$TARGET_ROOT_DIR$/bin/example.exe"</div>
	<div class="triple_indent">iconIndex="0"/></div>
	<div class="double_indent">&lt;link</div>
	<div class="triple_indent">linkFilePath="$DESKTOP_FOLDER$/Example.lnk"</div>
	<div class="triple_indent">path="$TARGET_ROOT_DIR$/bin/example.exe"</div>
	<div class="triple_indent">workingDirectory="$TARGET_ROOT_DIR$/bin"</div>
	<div class="triple_indent">description="Hello World Example"</div>
	<div class="triple_indent">iconPath="$TARGET_ROOT_DIR$/bin/example.exe"</div>
	<div class="triple_indent">iconIndex="0"/></div>
	<div class="indent">&lt;/links></div>
	&lt;/package>
	</span>

	<h3 id="creating_example_setup">6.3 Creating a Setup Program from the Example Package XML</h3>
	
	<ul>
		<li>Configure Wingstall as described in the <a href="#wingstall_config">Wingstall Configuration</a> section.</li>
		<li>Creating a setup program requires three steps:</li>
	</ul>
	
	<ol>
	<li>Creating package binary file from the package XML file:
		<ul>
		<li>Open a command prompt or Windows Terminal window to the %WINGSTALL_ROOT%/example/setup/deflate<sup><a href="footnotes.html#footnote-1">1</a></sup> directory</li>
		<li>To create a package, run the following command:
		<strong><pre>C:\work\wingstall\example\setup\deflate>wingstall -v --create-package example.xml</pre></strong></li>
		<li>This command generates the following output:
<pre>
creating package 'C:/work/wingstall/example/setup/deflate/example.xml'...
==> C:/work/wingstall/example/setup/deflate/example.index.xml
writing files (100%)
writing succeeded
==> C:/work/wingstall/example/setup/deflate/example.bin
==> C:/work/wingstall/example/setup/deflate/example.info.xml
</pre></li>
		<li>The <strong>wingstall --create-package</strong> command generates three files: 
		<ul>
		<li><strong>example.index.xml</strong> contains the contents of the package index; 
		it lists names of the files and directories included in the package</li>
		<li><strong>example.bin</strong> contains the package itself</li>
		<li><strong>example.info.xml</strong> is a short package info 
		that is needed in addition to the <strong>example.bin</strong> file in the next step</li>
		</ul></ul></li>
		<br/>
		
	<li>Generating a Visual C++ setup program from the package binary file:
		<ul>
		<li>To generate a Visual C++ setup program from the package, run the following command:
		<strong><pre>C:\work\wingstall\example\setup\deflate>wingstall -v --make-setup example.bin</pre></strong></li>
		<li>This command generates the following output:
<pre>
creating setup from package 'C:/work/wingstall/example/setup/deflate/example.bin'...
> C:/work/wingstall/example/setup/deflate/example.info.xml
> C:/work/wingstall/example/setup/deflate/example.bin
==> C:/work/wingstall/example/setup/deflate/program/data.hpp
==> C:/work/wingstall/example/setup/deflate/program/data.cpp
==> C:/work/wingstall/example/setup/deflate/program/resource.rc
==> C:/work/wingstall/example/setup/deflate/program/main.cpp
==> C:/work/wingstall/example/setup/deflate/program/setup.vcxproj
setup for package 'C:/work/wingstall/example/setup/deflate/example.bin' created
</pre></li>
		<li>The <strong>wingstall --make-setup</strong> command:
		<ul>
		<li>creates a subdirectory named <strong>program</strong> under the directory that contains the <strong>example.bin</strong> file</li>
		<li>generates a Visual C++ setup program to the <strong>program</strong> subdirectory</li>
		<li>embeds the <strong>example.bin</strong> package in the setup executable as a Windows resource</li>
		</ul></ul></li>
		<br/>
		
		<li>Compiling the generated setup Visual C++ project using Visual Studio:
			<ul>
			<li>Open %WINGSTALL_ROOT%/example/setup/deflate/program/setup.vcxproj<sup><a href="footnotes.html#footnote-1">1</a></sup> in Visual Studio</li>
			<li>The current configuration should be <strong>Debug | x64</strong>, if it is not, you should activate the Debug configuration and x64 platform.
			<li>Build the project. No compilation errors or warnings are expected.</li>
			<li>The output for the <strong>Debug</strong> configuration is the <strong>setupd.exe</strong> in the <strong>x64/Debug</strong> subdirectory.
			<li>Activate the <strong>Release | x64</strong> configuration.</li>
			<li>Build the project. No compilation errors or warnings are expected.</li>
			<li>The output for the <strong>Release</strong> configuration is the <strong>setup.exe</strong> in the <strong>x64/Release</strong> subdirectory.
			<li>The file names of the generated Debug and Release mode executables, setupd.exe and setup.exe, can be changed to any file names having 
				an .exe extension. The setup programs should work in the same way.
			</ul>
		</li>
	</ol>

	<h2 id="engine_variables">7 Installation Engine Variables</h2>
	
	<p>
		These variables may be used as path components in the package XML:
	</p>
	
    <table>
		<tr>
			<th>name</th>
			<th>description</th>
			<th>example</th>
		</tr>
        <tr>
            <td class="content">$TARGET_ROOT_DIR$</td>
            <td>an absolute path to the installation directory in the target file system, can be changed by the user at installation time</td>
			<td><strong>C:\example</strong></td>
        </tr>
		<tr>
			<td class="content">$PREINSTALL_DIR$</td>
			<td>an absolute path to the preinstall subdirectory under the $TARGET_ROOT_DIR$ directory; receives a random UUID value at installation time</td>
			<td><strong>C:\example\5c556af5&#8209;31d6&#8209;4845&#8209;93af&#8209;67cb7956ce47</strong></td>
		</tr>
		<tr>
			<td class="content">$APP_NAME$</td>
			<td>the value of the <tt>appName</tt> attribute of the <tt>package</tt> element in the package XML document</td>
			<td><strong>Example</strong></td>
		</tr>
		<tr>
			<td class="content">$APP_VERSION$</td>
			<td>the value of the <tt>version</tt> attribute of the <tt>package</tt> element in the package XML document</td>
			<td><strong>1.0.0</strong></td>
		</tr>
		<tr>
			<td class="content">$PRODUCT_ID$</td>
			<td>the value of the <tt>id</tt> attribute of the <tt>package</tt> element in the package XML document,
			or random UUID if there is no <tt>id</tt> attribute</td>
			<td><strong>078c97f9-657e-44b1-9058-e0c2d4b3a541</strong></td>
		</tr>
		<tr>
			<td class="content">$PUBLISHER$</td>
			<td>the value of the <tt>publisher</tt> attribute of the <tt>package</tt> element in the package XML document</td>
			<td><strong>Joe Coder</strong></td>
		</tr>
		<tr>
			<td class="content">$START_MENU_PROGRAMS_FOLDER$</td>
			<td>an absolute path to the 'Programs' folder of the 'Start' menu in the target file system at installation time</td>
			<td><strong>C:\ProgramData\Microsoft\Windows\Start Menu\Programs</strong></td>
		</tr>
		<tr>
			<td class="content">$DESKTOP_FOLDER$</td>
			<td>an absolute path to the 'Desktop' folder in the target file system at installation time</td>
			<td><strong>C:\Users\seppo\OneDrive\Typyt</strong></td>
		</tr>
		<tr>
			<td class="content">$PROGRAM_FILES_DIR$</td>
			<td>an absolute path to the 'Program Files' directory in the target file system at installation time</td>
			<td><strong>C:\Program Files</td>
		</tr>
    </table>
	
	<h2 id="installer_actions">8 Detailed Actions of the Installer</h2>
	
	<p>
		The following actions take place during the installation (execution of the <strong>setup.exe</strong>):
	</p>
	
	<ol>
		<li>Starting phase...
			<ol>
				<li>Setup.exe needs Administrator privileges, because it writes under the HKEY_LOCAL_MACHINE registry key,
				and because it may create system environment variables for all users, therefore Windows shows the UAC dialog.</li>
				<li>If the user clicks the 'Yes' button in the UAC dialog, the installer executable is started, otherwise the installer executable is not started.</li>
			</ol>
		</li>
		<li>Initialization phase...
			<ol>
				<li>The installer program initializes the libraries contained by the <strong>wingstall.sln</strong> solution.</li>
				<li>Compressed Unicode database needed during the installation is expanded and initialized.</li>
				<li>Install window is created and shown.</li>
				<li>The user can change the 'Containing directory' by clicking the '...' button to the right of the 'Containing directory' text box.</li>
				<li>The user can type a directory to the 'Containing directory' text box.</li>
				<li>In the previous two cases the value of the 'Installation directory' text box is changed appropriately.</li>
				<li>The user can change the value of the 'Installation directory' text box.
				<li>If the user clicks the <strong>Close</strong> button, the installer application is exited.</li>
				<li>If the user clicks the <strong>Install</strong> button, the initialization phase ends, and the preinstall phase is started.</li>
			</ol>
		</li>
		<li>Preinstall phase...
			<ol>
				<li>A thread that runs the installation is started.</li>
				<li>User-chosen installation directory is set to the package as the value of the "$TARGET_ROOT_DIR$" variable.</li>
				<li>The compression method is read from the uncompressed package data and appropriate decompression streams are initialized.</li>
				<li>A Boolean value telling whether the preinstall component is present is read from the uncompressed package data.</li>
				<li>If the preinstall component is not present, the preinstall phase ends, and the main installation phase is started.</li>
				<li>Otherwise the installation status is set to the value 'checking prerequisites....'</li>
				<li>The preinstall component creates a preinstall directory.</li>
				<li>The preinstall component reads metadata for the included preinstall files and preinstall commands from the decompression streams.</li>
				<li>The preinstall component reads contents of the preinstall files from the decompression streams and writes them to the preinstall directory.</li>
				<li>The preinstall component executes preinstall commands. If any command throws an exception or returns a nonzero exit code,
					an error message is shown to the user and the installation is aborted.</li>
				<li>In any case the preinstall component removes the preinstall directory.</li>
			</ol>
		</li>
		<li>Main installation phase...
			<ol>
				<li>The installation status is set to the value 'reading package index...'</li>
				<li>The package index is read from the decompression streams. The package index contains names of directories and files,
					sizes of files and last write times of directories and files. 
					Environment variables, path directories, link directories and links are also contained by the package index.</li>
				<li>The installation status is set to the value 'copying files...'</li>
				<li>The data of each component in turn is read from the decompression streams. During this
					the directories are created, and the subdirectories and files they contain are read recursively.</li>
				<li>As the contents of the files is extracted from the package, they are created as files in the target file system and 
					their data is written to the target file system files. 
					The last write time of files and directories are set after their data is written.</li>
				<li>The installation status is set to the value 'creating environment variables...'</li>
				<li>Environment variables contained by the package are created and path directories are appended to the PATH.</li>
				<li>WM_SETTINGCHANGE message is broadcasted so that Windows components know that PATH has been changed.</li>
				<li>The installation status is set to the value 'creating links...'</li>
				<li>Link directories and shortcuts are created.</li>
				<li>If an uninstaller is included, the installation status is set to the value 'writing uninstall information file...'</li>
				<li>In this case a package index file 'uninstall.bin' that has knowledge of directories, files, environment variables, and links that 
					are contained by the main package is written to the $TARGET_ROOT_DIR$ directory. 
					The preinstall information of directory existence, file existence and SHA-1 hash codes of file contents, 
					environment variables, link directories and links is recorded in the uninstall information.
					Old values of environment variables can be restored during uninstallation, for example.
					If the uninstaller is included, the package also contains an 'uninstall.exe' file that has already been written to the $TARGET_ROOT_DIR$ directory.</li>
				<li>In any case the installation status is set to the value 'creating installation registry information...'</li>
				<li>Application installation information is written to the Windows registry under the registry key
					'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{&lt;package_id_UUID>}'</li>
				<li>The installation status is set to the value 'installation succeeded'.</li>
				<li>This is the final installation state. The user may only click the <strong>Close</strong> button to close the installer.
					The installer window looks like this:</li><br/>
				<img src="image/installation_succeeded.png"/>
			</ol><br/>
		<li>Exceptions during the installation...
			<ul>
				<li>If any file or registry operation fails during the installation, the installation is aborted, 
					and 'installation failed' status is reported to the user. 
					This means that operations are not rollbacked, the system is left as it is in the middle of the installation.</li>
				<li>If the user clicks the <strong>Close</strong> button during the installation, the installation is paused, 
					and the user is shown the following dialog:</li><br/>
				<img src="image/abort_continue_dialog.png"/><br/><br/>
				<li>If the user clicks the <strong>Abort</strong> button, 
					the installation is aborted and the system is left as it is in the middle of the installation. 
					Then the user may only click the <strong>Close</strong> button in the main installer window.</li>
				<li>If the user clicks the <strong>Continue</strong> button, the installation continues where it has been paused.</li>
			</ul>
		</li>
	</ol>
	
	<h2 id="uninstaller">9 Uninstaller</h2>
	
	<p>
		The uninstaller can be launched either from the Windows Control Panel | Add/Remove Programs section:<br/><br/>
		<img src="image/add_remove_programs.png"/><br/><br/>
		or by double-clicking the <strong>uninstall.exe</strong> that is located in the $TARGET_ROOT_DIR$ directory:<br/><br/>
		<img src="image/uninstall.png"/>
	</p>
	
	<h3 id="uninstaller_user_interface">9.1 Uninstaller User Interface</h3>
	
	<p>
		The user interface of the uninstaller will look like this:<br/><br/>
		<img src="image/uninstaller.png"/>
	</p>
	
	<h3 id="uninstaller_actions">9.2 Detailed Actions of the Uninstaller</h3>
	
	<ol>
		<li>
			Starting phase...
			<ol>
				<li>uninstall.exe needs Administrator privileges, because it may delete registry key under the HKEY_LOCAL_MACHINE,
				and because it may modify or remove system environment variables for all users, so Windows shows the UAC dialog.</li>
				<li>If the user clicks the 'Yes' button in the UAC dialog, the uninstaller executable is started, otherwise the uninstaller executable is not started.</li>
			</ol>
		</li>
		<li>Uninstallation phase...
			<ol>
				<li>The uninstallation status is set to the value 'running uninstall commands...'</li>
				<li>The uninstaller runs uninstall commands.</li>
				<li>If some command is not found or returns a nonzero exit code other than 99, the uninstallation continues,
					but an error message is written to the uninstall log window.</li>
				<li>Only if some uninstall command returns special exit code 99, the uninstallation is aborted.</li>
				<li>The uninstallation status is set to the value 'removing links...'</li>
				<li>The uninstaller removes each shortcut (.lnk file) in turn.</li>
				<li>If a shortcut with the same name existed before installation, that shortcut is then restored.</li>
				<li>The unistaller removes each link directory in turn, if the link directory did not exist at installation time.</li>
				<li>The uninstallation status is set to the value 'removing environment variables...'</li>
				<li>For each environment variable: if the environment variable existed before installation, the old value of that environment variable
					is restored, otherwise the environment variable is removed.</li>
				<li>For each path directory: if the path directory did not exist before installation, that path directory is removed from the system PATH.</li>
				<li>WM_SETTINGCHANGE message is broadcasted so that Windows components know that PATH has been changed.</li>
				<li>The uninstallation status is set to the value 'removing files...'</li>
				<li>For each component in turn: uninstall the directories of the component.</li>
				<li>The uninstallation of a directory consists of (1) uninstalling each installed file of the directory, 
					(2) uninstalling each installed subdirectory of the directory,
					(3) if the directory did not exist at installation time and the directory is now empty, it is removed.</li>
				<li>The uninstallation of an installed file removes the file if it did not exist at installation time and it has not been changed
					since installation time.</li>
				<li>Checking if the file has changed: (1) the size of the file at installation time is compared to the current size of the file.
					If the sizes differ, the file has been changed. (2) Otherwise: the SHA-1 hash code of the file calculated at installation time is compared to
					the SHA-1 hash code calculated from the current contents of the file. If the hash codes differ, the file has been changed.
					(3) Otherwise: the file has not been changed.</li>
				<li>Note: the uninstaller does not remove files that the installer did not install.</li>
				<li>The uninstallation status is set to the value 'removing installation information from registry...'</li>
				<li>Application installation information registry key
					'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{&lt;package_id_UUID>}' is removed.</li>
				<li>The uninstallation status is set to the value 'installation succeeded'</li>
				<li>This is the final uninstallation state. The user may only click the <strong>Close</strong> button to close the uninstaller.
					The uninstaller window looks like this:</li><br/>
				<img src="image/uninstallation_succeeded.png"/>
			</ol>
		</li><br/>
		
		<li>Exceptions during the uninstallation...
			<ul>
				<li>If any file or registry operation fails during the uninstallation, 
					the error message is written to the uninstall log window, but the uninstallation is not aborted.</li>
				<li>If the user clicks the <strong>Close</strong> button during the uninstallation, the uninstallation is paused, 
					and the user is shown the following dialog:</li><br/>
				<img src="image/uninstaller_abort_continue_dialog.png"/><br/><br/>
				<li>If the user clicks the <strong>Abort</strong> button, 
					the uninstallation is aborted and the system is left as it is in the middle of the uninstallation. 
					Then the user may only click the <strong>Close</strong> button in the main uninstaller window.</li>
				<li>If the user clicks the <strong>Continue</strong> button, the uninstallation continues where it has been paused.</li>
			</ul>
		</li>
	</ol>
	
	<h2 id="building_and_installing_wingstall">10 Building and Installing Wingstall from Sources</h2>
	
	<p>
		Wingstall tools and libraries can be used without building them from <strong>wingstall.sln</strong>. 
		Binaries are located in the %WINGSTALL_ROOT%/<strong>bin</strong><sup><a href="footnotes.html#footnote-1">1</a></sup> subdirectory that should be in the system PATH environment variable 
		and libraries are in the %WINGSTALL_ROOT%/<strong>lib</strong><sup><a href="footnotes.html#footnote-1">1</a></sup> subdirectory.
	</p>
	
	<p>
		If you want to build Winsgstall yourself using Visual Studio here's how to do it:
	</p>
	
	<h3 id="building_wingstall">10.1 Building Wingstall from Sources</h3>
	
	<ul>
		<li>Configure your Visual Studio as described in the <a href="#vs_config">Visual Studio Configuration</a> section.</li>
		<li>Open 'Visual Studio 2022 x64 Native Tools Command Prompt'.</li>
		<li>Change to %WINGSTALL_ROOT%/ext/zlib-1.2.11/contrib/masmx64<sup><a href="footnotes.html#footnote-1">1</a></sup> directory</li>
		<li>Run 'bld_ml64.bat'.
		<li>Open <strong>wingstall.sln</strong> with Visual Studio.</li>
		<li>Activate the <strong>Debug | x64</strong> configuration.</li>
		<li>Build the solution.</li>
		<li>Activate the <strong>Release | x64</strong> configuration.</li>
		<li>Build the solution.</li>
	</ul>
	
	<h3 id="installing_wingstall">10.2 Installing Wingstall Tools and Libraries Built from Sources</h2>
	
	<p>
		If you want to install the tools and libraries built from <strong>wingstall.sln</strong> to the 
		%WINGSTALL_ROOT%/<strong>bin</strong><sup><a href="footnotes.html#footnote-1">1</a></sup> and 
		%WINGSTALL_ROOT%/<strong>lib</strong><sup><a href="footnotes.html#footnote-1">1</a></sup> directories, here's how to do it:
	</p>
	
	<ul>
		<li>Open a command prompt or Windows Terminal window to the %WINGSTALL_ROOT%/inst<sup><a href="footnotes.html#footnote-1">1</a></sup> directory.</li>
		<li>Run 'inst.bat'.</li>
		<li>Executables are copied from the x64\Debug and x64\Release directories to the %WINGSTALL_ROOT%/<strong>bin</strong><sup><a href="footnotes.html#footnote-1">1</a></sup> directory and
			libraries are copied from the x64\Debug and x64\Release directories to the %WINGSTALL_ROOT%/<strong>lib</strong><sup><a href="footnotes.html#footnote-1">1</a></sup> directory.</li>
	</ul>
	
    <br />	
</body>
</html>
